@page "/signUp"
@layout EmptyLayout
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager
@inject IIdentityService IdentityService

<MudContainer Class="pb-8" MaxWidth="@MaxWidth.Medium">
    <EditForm Model="userModel" OnValidSubmit="@OnValidSubmit">
        <MudCard Elevation="4" Class="px-sm-4 px-md-12 py-sm-4 py-md-6 py-lg-8 mt-4 mt-md-8 mt-lg-16 mx-auto">
            <MudCardContent>
                <MudText Class="mb-xs-4 mb-sm-8 mb-md-16" Typo="@Typo.h4" Align="@Align.Center">Please sign up!</MudText>
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudTextField T="@string"
                                      Class="my-2"
                                      Label="@nameof(userModel.UserName)"
                                      Variant="Variant.Outlined"
                                      @bind-Value="@userModel.UserName" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField T="@string"
                                      Class="my-2"
                                      Label="@nameof(userModel.Email)"
                                      Variant="Variant.Outlined"
                                      @bind-Value="@userModel.Email" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField T="@string"
                                      Class="my-2"
                                      Label="@nameof(userModel.Password)"
                                      Variant="Variant.Outlined"
                                      @bind-Value="@userModel.Password" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField T="@string"
                                      Class="my-2"
                                      Label="Confirm password"
                                      Variant="Variant.Outlined" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField T="@string"
                                      Class="my-2"
                                      Label="@nameof(userModel.FirstName)"
                                      Variant="Variant.Outlined"
                                      @bind-Value="@userModel.FirstName" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField T="@string"
                                      Class="my-2"
                                      Label="@nameof(userModel.LastName)"
                                      Variant="Variant.Outlined"
                                      @bind-Value="@userModel.LastName" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField T="@string"
                                      Class="my-2"
                                      Label="@nameof(userModel.Profession)"
                                      Variant="Variant.Outlined"
                                      @bind-Value="@userModel.Profession" />
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudTextField T="@string"
                                      Class="my-2"
                                      Label="@nameof(userModel.Specialization)"
                                      Variant="Variant.Outlined"
                                      @bind-Value="@userModel.Specialization" />
                    </MudItem>
                </MudGrid>
            </MudCardContent>
            <MudCardActions>
                <MudButton Class="mx-auto mt-8 py-2 px-12"
                           Size="@Size.Large"
                           Color="@Color.Primary"
                           Variant="@Variant.Filled"
                           ButtonType="@ButtonType.Submit">
                    Sign Up
                </MudButton>
            </MudCardActions>
        </MudCard>
    </EditForm>
</MudContainer>

@code {

    private UserSignUpViewModel userModel = new();

    private async Task OnValidSubmit()
    {
        try
        {
            var token = await IdentityService.SignUpAsync(userModel);
            NavigationManager.NavigateTo("/home");
            Snackbar.Add("You logged in succesfull!", Severity.Success);
        }
        catch (ValidationException e)
        {
            foreach (var (key, errors) in e.Errors)
            {
                Snackbar.Add($"{key} - {string.Join(", ", errors)}", Severity.Error);
            }
        }
        catch (Exception e)
        {
            Snackbar.Add(e.Message, Severity.Error);
        }
    }

}
