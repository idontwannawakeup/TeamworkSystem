@using TeamworkSystem.WebClient.ViewModels
@inject IDialogService DialogService

<MudCard Outlined="@true">
    <MudCardContent>
        <MudText Typo="@Typo.body1">@Ticket.Title</MudText>

        <MudChip Color="@Color.Primary"
                 Size="@Size.Small"
                 Label="@true"
                 Class="mx-0 my-3">TicketEpicName</MudChip>

        <MudElement HtmlTag="div" Class="d-flex align-center gap-2">
            <MudTooltip Text="Epic">
                <MudIcon Icon="@Icons.Material.Filled.Explicit"
                         Color="@Color.Primary"
                         Size="@Size.Small" />
            </MudTooltip>

            <MudTooltip Text="Priority: Medium">
                <MudIcon Icon="@Icons.Material.Filled.CompareArrows"
                         Color="@Color.Warning"
                         Size="@Size.Small" />
            </MudTooltip>

            <MudIconButton Icon="@Icons.Material.Filled.OpenInNew"
                           Size="@Size.Small"
                           Color="@Color.Primary"
                           Class="ml-auto"
                           Link="@TicketLink" />

            <MudMenu Icon="@Icons.Material.Filled.MoreHoriz" Size="@Size.Small" Dense="@true">
                <MudMenuItem Link="@PropertiesLink">Edit</MudMenuItem>
                <MudMenuItem OnClick="OnDeleteClickAsync">Delete</MudMenuItem>
            </MudMenu>
        </MudElement>
    </MudCardContent>
</MudCard>

@code {

    [Parameter] public TicketViewModel Ticket { get; set; }

    private string TicketLink => $"/project/ticket/{Ticket.Id}";

    private string PropertiesLink => $"/project/ticket/{Ticket.Id}/properties";

    private async Task OnDeleteClickAsync()
    {
        var confirmed = await DialogService.ShowMessageBox(
            title: "Confirm deleting",
            message: "Are you sure you want to delete this ticket?",
            cancelText: "Cancel",
            options: new DialogOptions
            {
                FullWidth = true,
                MaxWidth = MaxWidth.Small
            });

        if (confirmed)
        {
            // TODO call delete method from TicketsService
        }
    }

}
